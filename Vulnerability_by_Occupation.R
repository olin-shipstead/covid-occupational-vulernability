# Olin Shipstead
# 15 March 2020

# Exercise recreating NYTimes plot:
# https://www.nytimes.com/interactive/2020/03/15/business/economy/coronavirus-worker-risk.html

library(ggplot2)
library(plotly)

exposure <- read.csv("Exposed_to_Disease_or_Infections.csv")[,c(1,3)]
proximity <- read.csv("Physical_Proximity.csv")[,c(1,3)]
employment <- read.csv("national_M2018_dl.csv", header=T)
employment<- employment[,c(2,4,7)]

colnames(employment) <- c("Occupation","Employment","Mean Salary")

rawdata <- merge(proximity, exposure, by="Occupation")
colnames(rawdata) <- c("Occupation", "Proximity","Exposure")
rawdata1 <- merge(rawdata,employment, by="Occupation")
rawdata3 <- rawdata1[!duplicated(rawdata1),] # duplicated used to remove repeat observations
colnames(rawdata3) <- c("Occupation","Proximity","Exposure","Employment","Mean Salary")

rawdata3$Exposure <- as.numeric(as.character(rawdata3$Exposure)) # used to convert factor column to numeric
rawdata3$Employment <- as.numeric(as.character(gsub(",","",rawdata3$Employment))) # gsub used to remove commas
rawdata3$`Mean Salary` <- as.numeric(as.character(gsub(",","",rawdata3$`Mean Salary`)))

p <- ggplot(rawdata3, aes(Proximity, Exposure))
p + geom_point(alpha=0.5, na.rm=T, aes(size=Employment, color=`Mean Salary`))+
    scale_size(range=c(1,12))+
    scale_color_gradient(low="blue",high="red")+
    geom_label(aes(label=ifelse(Employment>1500000 & (Exposure > 60 | Proximity > 70),as.character(Occupation),NA)), nudge_y = 7)+
    labs(title = "Vulnerability to Infection by Occupation", subtitle = "Using data from O*NET, Department of Labor")+
    theme_classic()












